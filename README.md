# Doctor's schedule
#### Video Demo: https://youtu.be/VGTuYrGWWKY
#### Description:
##### The layout of files
###### The system how folders and files are stored is not accidental. Using Express.js framework has forced me to put them in the way we can observe and analyse in next paragraphs.
##### The "public" folder
###### There is a CSS folder with "styles.css" responsible for website's appearance. Images are stored in the separate folder. All are imported to ejs file and shown on the webpage. The most of code is stored in script.js file which will be the topic of my next chapter
##### Explaining of the main part of program - "script.js"
###### In the beginning we have some global variables - mainly storing crucial HTML elements. Then, below - we can observe several helper functions - creating them helped me to shorten the code.
###### -"clearAll" function is used by program for clearing inputs after every action taken on the pop up window.
###### -"setDefaultButtons" sets buttons in a pop up window to a default state i.e. unlocks the submit button and disables other two. Utility of this function will be shown later in event listeners related to the pop up window.
###### -"datesForWeekCreator" is used every time the user wants to get a schedule for the certain week. It takes the date and according to it, creates dates for 5 next days - until Saturday. Each of them is turned into string and all are stored in an array.
###### Another functions are two event listeners assigned to both arrows. Clicking on the right arrow changes the date of the monday we would like to create a schedule for (by 7 days so we get the date of the next monday in the calendar). Then our new date is used in advanced function "invoker" (written in the bottom of the same file) which will make a new schedule with new batch of dates (for the next week). The left arrow works in similar way with the difference that it starts creating a schedule for a previous week.
###### After two event listeners we can find "scheduleCleaner". This function checks if there have been generated cells in the schedule, below the first row. If not - it means we just opened the program and there are no cells to remove. If there are any cells below first row (like in case of moving to a next/previous week) they are removed in purpose of making place for new group of cells.
##### Creating a schedule
###### The most complex function of the project requires having an array of times and a date of Monday found in the week we want a schedule for. It's an async function due to fact there are a lot of functions inside which must be invoked in a particular order. As the first on, program uses the helper function mentioned before - "datesForWeekCreator" and implement new batch of dates in the first row. Then we have a "bridge" connecting front-end and back-end. The fetch method requests for data. Then succesfully received information is assigned to a variable. After that, we use another previously mentioned function - "scheduleCleaner". After using it, we can be sure there is space for adding cells below the row with dates and names of days. Then, program creates rows, cells and join them together checking. Slots which were booked are marked thanks to data fetched from the database.
##### The functionning of the pop-window
###### As we can see in the bottom of the "script.js", after schedule is created, the "booking" function is invoked. The main task of it is assigning to each timeslot the event listener showing the pop window after clicking. If clicked slot was booked - the window displays data in inputs, blocks submit button and unlocks buttons repsonsible for changing and deleting booking.
###### Another function is responsible for closing window and setting buttons to a default state if it is necessary.
###### Then we have 3 different functions, each one is attached as event listener to one of 3 buttons. Clicking on the submit button collects a date, a time and data from inputs. All of this are packed into array and sent with fetch method to the back-end. If posting was succesful, a clicked slot changes appearance and the window is hidden. "changeButton" and "deleteButton" work in quiet similar way but main differences are: other methods used inside of fetch and of course different effect on data and slots. Both actions require also using "setDefaultButtons" in opposite to submitting.
##### Views
###### The HTML website is generated in the template engine - Embedded JavaScript Templating. I am going to use it's power in future to template some data into while developing the project. Meanwhile, we can observe here among the others such elements like arrows, the main part - the schedule (only one row as the rest is generated by JS) and the pop up form which is hidden by default.
##### The back-end
###### The main task of "app.js" file is getting requests from a front-end, eventually manipulate data, usually taken from the database and sending responses. In the top is imported and set express.js and some necessary tools like sqlite.
###### There are 2 GET routes. First one with '/' renders the website. Another one with '/getting' reacts when it comes a proper request, take all rows with data from the database and sends with the response to the front-end.
###### A little bit more complex seems to be the POST /posting route. Data sent with POST method (in script.js) is received here. The handler function takes data sent with request, "pastes" it to the SQL command in purpose of inserting it in the correct way to the database. If everything goes well, the status code 201 is sent. I've implemented the error handler, too. In case of occurring error, the description is logged in the terminal and the front-end part is receiving the status code 500 - "Internal Server Error".
###### The route PUT /change works very similar to the previously analysed route but updates instead of inserting.
###### Differently was made the route DELETE. For training the other way of sending data to the back-end, I've decided not to send data inside of body in fetch with DELETE method (in script.js). All data needed for deleting a certain row in this case (i.e. time and date) is sent in URL. In app.js, this data is grabbed using req.params and implemented in SQL command.
##### Other files
###### - "db.sqlite" - here is stored a database.
###### - "sql.js" - Keeps the code responsible for deleting all database (if such exists) and forms the new one.
###### - "hoursArray.txt" - if we want to change system of timeslots - we can copy one from already prepared arrays, and paste in the first line of script.js, instead of current array.
###### -"node_modules" - The folder where helpful modules like sqlite3 are stored. They have been imported and are necessary for node.js working.
###### -"package-lock.json" and "package.json" - files created after installing npm.
##### Important:
###### The port is set out in the bottom of app.js.
###### If you want to use the program - type "node app.js" in the terminal and open in a browser a port number 4002.
###### If you are going to replace the old database with the new one - type "node sql.js".